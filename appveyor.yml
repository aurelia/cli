version: '1.1.2.{build}'
image: Windows Server 2019

environment:
  nodejs_version: "12"
platform:
  - Any CPU

init:
  - ps: git config --global core.autocrlf input


# Install scripts. (runs after repo cloning)
install:
  # Get the latest stable version of Node.js or io.js
  - ps: Install-Product node $env:nodejs_version
  # install modules
  - npm install --global npm@latest
  - set PATH=%APPDATA%\npm;%PATH%
  - npm install
  - docker version
  - node --version
  - npm --version

before_build:
  - npm run test

build_script:
  - npm run build
  # - npm install
  - npm link

test_script:
  - ps: Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
  - docker-switch-linux
  # - au new sixth -u -s cli-bundler,alameda,http2,typescript,htmlmin-min,less,postcss-typical,jest,protractor,scaffold-navigation,docker
  # - cd ./sixth
  # - npm install
  # - npm link aurelia-cli
  # - npm run docker:build
  - au new first -u -s htmlmin-max,sass,postcss-typical,karma,cypress,docker && cd ./first && npm install && npm link aurelia-cli && npm run docker:build
  - au new second -u -s http2,typescript,htmlmin-min,less,postcss-typical,jest,protractor,scaffold-navigation,docker && cd ./second && npm install && npm link aurelia-cli && npm run docker:build
  - au new third -u -s dotnet-core,typescript,htmlmin-max,stylus,postcss-basic,jest,protractor,docker && cd ./third && npm install && npm link aurelia-cli && npm run docker:build
  - au new forth -u -s http2,dotnet-core,htmlmin-min,sass,postcss-typical,karma,cypress,scaffold-navigation,docker && cd ./forth && npm install && npm link aurelia-cli && npm run docker:build
  # four scaffolding using Alameda with various configurations
  - au new fifth -u -s cli-bundler,alameda,htmlmin-max,sass,postcss-typical,karma,cypress,docker && cd ./fifth && npm install && npm link aurelia-cli && npm run docker:build
  - au new sixth -u -s cli-bundler,alameda,http2,typescript,htmlmin-min,less,postcss-typical,jest,protractor,scaffold-navigation,docker && cd ./sixth && npm install && npm link aurelia-cli && npm run docker:build
  - au new seventh -u -s cli-bundler,alameda,dotnet-core,typescript,htmlmin-max,stylus,postcss-basic,jest,protractor,docker && cd ./seventh && npm install && npm link aurelia-cli && npm run docker:build
  - au new eighth -u -s cli-bundler,alameda,http2,dotnet-core,htmlmin-min,sass,postcss-typical,karma,cypress,scaffold-navigation,docker && cd ./eighth && npm install && npm link aurelia-cli && npm run docker:build

cache:
  - '%APPDATA%\npm-cache'

on_success:
  - ps: Write-Host "All Done" -ForegroundColor DarkGreen -BackgroundColor White
